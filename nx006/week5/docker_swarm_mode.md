# Docker Swarm Mode

규모가 큰 서비스의 경우, 여러 개의 Docker Container가 서로 맞물려 작동할 수 있습니다. Docker Container가 많아지면, 이 컨테이너를 관리하고 구성하는 도구의 필요성을 느끼게 됩니다. 그게 바로 Docker Swarm Mode 입니다.

도커 스웜 모드는 물리적 서버 클러스터를 통해 컨테이너를 확장하기 위한 도구입니다. 도커 팀에서 개발하였습니다. 여러 도커 컨테이너를 클러스터로 구성하여 유기적으로 결합하는 오케스트레이션 도구입니다.

도커 스웜 모드는 주로 다음과 같은 오케스트레이션 기능을 제공합니다.

1. 도커 엔진과 통합된 다중 서버 클러스터 환경
2. 역할이 분리된 분산 설계
3. 서비스 확장과 원하는 상태 조정
4. 서비스 스케줄링
5. 로드 밸런싱
6. 서비스 검색
7. 롤링 업데이트

## 도커 스웜 모드 VS K8S

도커 스웜 모드와 K8S의 차이점은 무엇일까?

먼저 책에서 나온 차이점으로는 다음이 있다.

| 도커 스웜 모드 | 쿠버네티스 |
| --- | --- |
| - 매니저 노드는 워커 노드의 역할인 서비스 컨테이너의 역할도 수행 가능<br>- But, 관리 노드의 부하를 고려해 역할을 분리하여 사용하는 것을 권장한다<br>- --constraint node.role != manager | - 마스터 노드는 워커 노드의 전체적인 관리만 수행<br>- 마스터 노드가 서비스 컨테이너 역할을 하지는 않음 |

그 외에도, K8S는 도커 스웜 모드에 비해서 기능이 더 많고, 안정적인 오케스트레이션 및 모니터링, 자동화된 관리 도구를 제공한다.

또한 쿠버네티스는 자동 롤오버, 보안 솔루션 등의 기능을 제공한다.

그러나 쿠버네티스의 단점으로는, 러닝 커브가 다소 높다는 데 있다. 쿠버네티스 자체만으로 러닝 커브가 높지만, 쿠버네티스와 함께 쓰이는 도구들 역시 다소 러닝 커브가 높은 편이라, 작고 간단한 서비스의 경우 도커 스웜이, 크고 복잡한 서비스의 경우 쿠버네티스가 사용된다.

K8S와 같이 사용되는 도구는 보통 다음과 같다.

- CI/CD: Jenkins, Github Action, TeamCity 등과 같은 CI/CD 도구와 같이 사용된다.
- 프로메테우스: 컨테이너 모니터링 도구로, 컨테이너의 실시간 상태를 수집한다
- 그라파나: 모니터링 시각화 도구이다

https://youtu.be/-GsWFaQg6Q0?si=LDMfG2HIBAXKDtrO

카카오의 경우에도 K8S가 아닌 도커 스웜으로 Redis SaaS 플랫폼을 만든 경험을 소개한다. 여기서도 K8S의 높은 러닝 커브에도 불구하고, 서비스에서 얻어갈 수 있는 기능이 많지 않아서, 비교적 간단한 도커 스웜을 사용했다고 소개한다.

또한 K8S는 CRI(Container Runtime Interface)를 사용해서 컨테이너를 관리하는 데, Docker는 공식적으로 CRI를 지원하지 않는다. 그래서 자체적인 도커 인터페이스를 사용한다. 그래서 K8S에서는 Docker Interface를 deprecate 한 적도 있다.

하지만 Docker와 다르게 K8S는 CNCF에서 관리하는 완전한 오픈소스이고, 파트너 오픈소스 생태계 역시 매우 다양하기 때문에, 매우 큰 장점을 가진다.

## Docker Node의 구성

다중 서버를 클러스터에 합류시키면 모든 도커 스웜 모드의 노드는 각각 다른 역할을 수행한다.

- 매니저 노드
- 리더 노드
- 작업자 노드(Worker Node)

## Docker Swarm Mode 세팅

- 도커 스웜 모드 초기화

`docker swarm init [옵션]` 으로 초기화

- 도커 클러스터 구성

`docker swarm join --token [토큰]`